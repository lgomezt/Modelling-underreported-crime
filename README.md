# Modelling Underreported Spatio-temporal Crime Events
### Álvaro J. Riascos Villegas, Francisco Gómez, Jose Sebastian Ñungo, Lucas Gómez Tobón and Mateo Dulce Rubio

This repository contains all the instructions to replicate the paper "Modelling Underreported Spatio-temporal Crime Events" including its results, tables, and figures. To do so, first, it is necessary to download all the data from our [Zenodo repository](https://zenodo.org/record/7868622#.ZElgsHbMJD8) and locate it in the "Data" folder to facilitate the exercise of running the code. 

This repository has three main folders. The content of each one is outlined below:
- **Data:** This folder contains "files_dictionary.txt" which is a file with the description of the files that are in our [Zenodo repository](https://zenodo.org/record/7868622#.ZElgsHbMJD8). The purpose of this folder is to store all the data from [Zenodo](https://zenodo.org/record/7868622#.ZElgsHbMJD8), therefore you must download them and put them in there. 
- **Scripts:** This folder contains all the Python codes to develop our research. It is divided into three subfolders:
  - *1_preprocess_data:* This folder contains three scripts that are used to transform the raw data of citizens' crime reports and the official dataset of crime from the Colombian National Police into our clean matrices of events. Each script is a Jupyter Notebook with a detailed description of the process made. **The raw data used in our analysis is not provided as it contains sensitive information about crimes, victims and complainants. For this reason, some dummy observations are provided to run the code.**
  - *2_modeling:* It contains two Python files to create the functions to perform the algorithms described in Section 2 of our paper. 
  - *3_create_outputs:* It contains Jupyter Notebooks to produce all the results of our research. The data needed for those codes are located in our [Zenodo repository](https://zenodo.org/record/7868622#.ZElgsHbMJD8) so it is important to download all the files and located them in the "Data" folder. The following is the list of outputs produced by each script on this folder:
    - [figure_8_Bogota_jurisdiction_grid.ipynb](Scripts/3_create_outputs/figure_8_Bogota_jurisdiction_grid.ipynb): produces [Figure 8](Outputs/Figures/figure_8_bogota_grilla.png).
    - [figure_9_crimes_by_source_of_information.ipynb](Scripts/3_create_outputs/figure_9_crimes_by_source_of_information.ipynb): produces [Figure 9](Outputs/Figures/figure_9_unique_crimes_by_source_of_information.png).
    - [figure_15_Bogota_heatmap.ipynb](Scripts/3_create_outputs/figure_15_Bogota_heatmap.ipynb): produces [Figure 15](Outputs/Figures/figure_15_CUCB_crime_estimates.png)
    - [results_graphs.ipynb](Scripts/3_create_outputs/results_graphs.ipynb): produces [Figure 10](Outputs/Figures/figure_10_convergencia_global_mu2.png), [Figure 11](Outputs/Figures/figure_11_convergencia_global_q2.png), [Figure 12](Outputs/Figures/figure_12_convergencia_global_q_ultimo_periodo2.png), [Figure 13](Outputs/Figures/figure_13_convergencia_global_reporte(Nxrho)_mensual.png') and [Figure 14](Outputs/Figures/figure_14_convergencia_global_subreporte(Nxqxrho)_mensual.png).
    - [section_model_validation_graphs.ipynb](Scripts/3_create_outputs/section_model_validation_graphs.ipynb): produces [Figure 1](Outputs/Figures/figure_1_model_validation.png), [Figure 2](Outputs/Figures/figure_2_model_validation.png), [Figure 3](Outputs/Figures/figure_3_model_validation.png), [Figure 4](Outputs/Figures/figure_4_model_validation.png), [Figure 5](Outputs/Figures/figure_5_model_validation.png), [Figure 6](Outputs/Figures/figure_6_model_validation.png), [Figure 7](Outputs/Figures/figure_7_model_validation.png).
- **Outputs:** This folder contains the results of our research in the form of Data, Figures, and Tables. Therefore, this folder is divided into those three categories:
  - *Data:* Contains the results of our models in CSV files. Those files are the inputs to produce our main Figures.
  - *Figures:* Contains the Figures of the paper.
  - *Tables:* Contains the Tables of the paper.
  
### Description of the Data
Due capacity of GitHub, we decided to upload all the data needed to replicate our paper in [Zenodo](https://zenodo.org/record/7868622#.ZElgsHbMJD8). The files uploaded to Zenodo are listed below:
<ul>
	<li><strong>distance_1000.csv:</strong> is a data frame with 5000 rows and 3 columns. Each row is a time step of the algorithms and reports the Euclidean distance between the vector with the real crime rate in each cell and the estimation made by the algorithm. The exercise was performed in the case of 1,000 arms and at most 100 super arms. This file is created in the&nbsp;<a href="https://github.com/lgomezt/Modelling-underreported-crime/blob/main/Scripts/2_modeling/times.py">times.py</a> script of our repository. </li>
	<li><strong>distance_10000.csv:</strong> is a data frame with 5000 rows and 3 columns. Each row is a time step of the algorithms and reports the Euclidean distance between the vector with the real crime rate in each cell and the estimation made by the algorithm. The exercise was performed in the case of 10,000 arms and at most 1,000 super arms. This file is created in the&nbsp;<a href="https://github.com/lgomezt/Modelling-underreported-crime/blob/main/Scripts/2_modeling/times.py">times.py</a> script of our repository. </li>
	<li><strong>distance_50000.csv:</strong> is a data frame with 5000 rows and 3 columns. Each row is a time step of the algorithms and reports the Euclidean distance between the vector with the real crime rate in each cell and the estimation made by the algorithm. The exercise was performed in the case of 50,000 arms and at most 5,000 super arms. This file is created in the&nbsp;<a href="https://github.com/lgomezt/Modelling-underreported-crime/blob/main/Scripts/2_modeling/times.py">times.py</a> script of our repository. </li>
	<li><strong>grilla_bogota.csv:&nbsp;</strong>is a data frame with 1638 rows and 5 columns in which each row described one grid of Bogot&aacute;. The difference between this file and grilla_bogota2.csv is that this file is used to plot Figure 9 which includes the rural area of the city. Something that is removed in our analysis due to the low density of crime in this zone.&nbsp;This file is created in the&nbsp;<a href="https://github.com/lgomezt/Modelling-underreported-crime/blob/main/Scripts/1_preprocess_data/3_create_grid.ipynb">3_create_grid.ipynb</a> script of our repository.</li>
	<li><strong>grilla_bogota2.csv:&nbsp;</strong>is a data frame with&nbsp;1008 rows and 10 columns in which each row described one grid of Bogot&aacute;. This file is more complete than grilla_bogota.csv because it includes the name of the Localidad in which the centroid of the cell belongs and its Rep. Rate. However, this file does not contain the rural area of the city.&nbsp;This file is created in the&nbsp;<a href="https://github.com/lgomezt/Modelling-underreported-crime/blob/main/Scripts/1_preprocess_data/3_create_grid.ipynb">3_create_grid.ipynb</a> script of our repository.</li>
	<li><strong>localidades.zip: </strong>this zipped folder contains the shapefiles to draw the map of Bogot&aacute; with its respective administrative limits. The information contained herein is of a public nature and can also be found on the government&#39;s <a href="https://datosabiertos.bogota.gov.co/dataset/localidad-bogota-d-c">open data page</a>.</li>
	<li><strong>matriz_eventos_real.csv: </strong>is a matrix of 498 rows and 368 columns in which each row represents one cell of Bogota&#39;s grid and each column represents the number of <em>real </em>crimes for each date. Recall that we assume that the total of crimes is the combination of NUSE and SIEDCO crimes after the removal of duplicates. This file is created in the&nbsp;<a href="https://github.com/lgomezt/Modelling-underreported-crime/blob/main/Scripts/1_preprocess_data/3_create_grid.ipynb">3_create_grid.ipynb</a> script of our repository.</li>
	<li><strong>matriz_eventos_subreporte.csv:&nbsp;</strong>is a matrix of 498 rows and 368 columns in which each row represents one cell of Bogota&#39;s grid and each column represents the number of <em>subreported</em> crimes for each date. Recall that we assume that the number of sub-reported crimes is the number of crimes reported in NUSE. This file is created in the&nbsp;<a href="https://github.com/lgomezt/Modelling-underreported-crime/blob/main/Scripts/1_preprocess_data/3_create_grid.ipynb">3_create_grid.ipynb</a> script of our repository.</li>
	<li><strong>subreporte_ccb.csv: </strong>is a data frame of 498 rows and 4 columns that describe the Rep. Rate and lambda for each cell of Bogota&#39;s grid.&nbsp;This file is created in the&nbsp;<a href="https://github.com/lgomezt/Modelling-underreported-crime/blob/main/Scripts/1_preprocess_data/3_create_grid.ipynb">3_create_grid.ipynb</a> script of our repository.</li>
	<li><strong>upla.zip:&nbsp;</strong>this zipped folder contains other&nbsp;extra shapefiles to draw the map of Bogot&aacute; with its respective administrative limits. The information contained herein is of a public nature and can also be found on the government&#39;s <a href="https://datosabiertos.bogota.gov.co/dataset?res_format=KMZ">open data page</a>.</li>
	<li><strong>victimizaci&oacute;n.xlsx:&nbsp;</strong>is an Excel file with 20 rows and 4 columns that contains&nbsp;the Vict. Rate and the Rep. Rate for each Localidad of Bogot&aacute;. This information comes from <a href="https://www.ccb.org.co/Transformar-Bogota/Seguridad-y-Justicia/Encuesta-de-Percepcion-y-Victimizacion">survey-based victimization and victim crime reporting rates presented by Bogot&aacute;&rsquo;s Chamber of commerce (2014)</a>.</li>
</ul>

### Abstract
<p align = "justify">
Crime observations are one of the principal inputs used by governments for designing citizens' security strategies. However, crime measurements are obscured by underreporting biases, resulting in the so-called "dark figure of crime". Current approaches for estimating the "true" crime rate do not account for underreporting temporal crime dynamics. This work studies the possibility of recovering "true" crime incident rates over time using data from underreported crime observations and complementary crime-related measurements acquired online. For this, a novel underreporting model of spatiotemporal events based on the combinatorial multi-armed bandit framework was proposed. Through extensive simulations, the proposed methodology was validated for identifying the fundamental parameters of the proposed model: the "true" rates of incidence and underreporting of events. Once the proposed model was validated,  crime data from a large city, Bogotá (Colombia), was used to estimate the "true" crime and underreporting rates. Our results suggest that this methodology could be used to rapidly estimate the underreporting rates of spatiotemporal events, which is a critical problem in public policy design.
</p>
